/*jslint browser: true*/
/*jslint node: true*/
/*jslint browser: true*/
/*jslint nomen: true */
/*jslint plusplus: true */
/*global $, jQuery, alert, btoa, CKEDITOR*/

"use strict";

$(document).ready(function () {
    var fade = 150, delay = 500, showmap = false, autobusca = true;

    /* SHOW PASS */

    $("#senha-").show(function () {
        $("#senha-").smkShowPass2();
    });

    /* MODAL */

    $(".close, .closed").click(function () {
        location.reload();
    });

    /* ICHECK */

    $("input[type='checkbox'], input[type='radio']").show(function () {
        $("input[type='checkbox'], input[type='radio']").iCheck({
            checkboxClass: 'icheckbox_minimal',
            radioClass: 'iradio_minimal'
        });
    });

    /* MASKED */

    $("#phm").show(function () {
        $("#phm").mask("99:99:99");
    });

    $("#shm").show(function () {
        $("#shm").mask("99:99:99");
    });

    $("#pht").show(function () {
        $("#pht").mask("99:99:99");
    });

    $("#sht").show(function () {
        $("#sht").mask("99:99:99");
    });

    $("#phm-").show(function () {
        $("#phm-").mask("99:99:99");
    });

    $("#shm-").show(function () {
        $("#shm-").mask("99:99:99");
    });

    $("#pht-").show(function () {
        $("#pht-").mask("99:99:99");
    });

    $("#sht-").show(function () {
        $("#sht-").mask("99:99:99");
    });

    /* INSTALAÇÃO */

    $(".form-install").submit(function (e) {
        e.preventDefault();

        var senha_banco = btoa($("#senha_banco").val()), usuario = btoa($("#usuario").val()), senha = btoa($("#senha").val());

	    $.post("commitAplicativo.php", { servidor: $("#servidor").val(), banco: $("#banco").val(), usuario_banco: $("#usuario_banco").val(), senha_banco: senha_banco, nome: $("#nome").val(), usuario: usuario, senha: senha, email: $("#email").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-install").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'A instala&ccedil;&atilde;o foi feita com sucesso.', type: 'success', time: 1});
                window.setTimeout("location.href='index'", delay);
                break;
            default:
                $.smkAlert({text: data, type: 'warning', time: 2});
                break;
            }

            $(".btn-submit-install").html('Entrar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* LOGIN */

    $(".form-login").submit(function (e) {
        e.preventDefault();

        var usuario = btoa($("#usuario").val()), senha = btoa($("#senha").val());

	    $.post("trustLogin.php", { usuario: usuario, senha: senha, rand: Math.random()}, function (data) {
            $(".btn-submit-login").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'Login efetuado com sucesso.', type: 'success', time: 1});
                window.setTimeout("location.href='inicio'", delay);
                break;
            case 'root':
                $.smkAlert({text: 'Login efetuado com sucesso.', type: 'success', time: 1});
                window.setTimeout("location.href='a/index.php'", delay);
                break;
            case 'noip':
                $.smkAlert({text: 'Acesso Negado.', type: 'danger', time: 1});
                break;
            default:
                $.smkAlert({text: data, type: 'warning', time: 2});
                break;
            }

            $(".btn-submit-login").html('Entrar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* RECUPERAR SENHA */

    $(".form-recupera-senha").submit(function (e) {
        e.preventDefault();

	    $.post("recoverSenha.php", { email: $("#email").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-recover").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'A senha foi enviada para o seu email.', type: 'success', time: 2});
                window.setTimeout("location.href='index'", delay);
                break;
            default:
                $.smkAlert({text: data, type: 'warning', time: 2});
                break;
            }

            $(".btn-submit-recover").html('Recuperar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* EDITA USUARIO */

    $(".form-edita-usuario").submit(function (e) {
        e.preventDefault();

        var usuario = btoa($("#usuario-").val()), senha = btoa($("#senha-").val());

	    $.post("updateUsuario.php", { idlogin: $("#idlogin").val(), nome: $("#nome-").val(), usuario: usuario, senha: senha, email: $("#email-").val(), tipo: $("input[name='tipo-usuario-']:checked").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-edita-usuario").html('<img src="../img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'reload':
                $.smkAlert({text: 'Nem todos os plugins foram carregados, recarregando...', type: 'danger', time: 2});
                location.reload();
                break;
            case 'true':
                $.smkAlert({text: 'Usu&aacute;rio editado com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='usuario.php'", delay);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-edita-usuario").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* ADD REGISTRO */

    $(".form-add-registro").submit(function (e) {
        e.preventDefault();

	    $.post("insertRegistro.php", { idlogin: $("#idlogin-add").val(), tab: $("#tab-").val(), dia: $("#dia-").val(), mes: $("#mes-").val(), ano: $("#ano-").val(), phm: $("#phm-").val(), shm: $("#shm-").val(), pht: $("#pht-").val(), sht: $("#sht-").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-add-registro").html('<img src="../img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            /*switch (data) {
            case 'reload':
                $.smkAlert({text: 'Nem todos os plugins foram carregados, recarregando...', type: 'danger', time: 2});
                location.reload();
                break;
            case 'true':
                $.smkAlert({text: 'Registro adicionado com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='index.php'", delay);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }*/
            if (data === "reload") {
                $.smkAlert({text: 'Nem todos os plugins foram carregados, recarregando...', type: 'danger', time: 2});
                location.reload();
            } else if (data.match(/<url>/g)) {
                $.smkAlert({text: 'Registro adicionado com sucesso.', type: 'success', time: 2});
                data = data.replace("<url>", "");
                data = data.replace("</url>", "");
                //document.location = data;
                window.setTimeout("location.href='" + data + "'", delay);
            } else {
                $.smkAlert({text: data, type: 'warning', time: 3});
            }

            $(".btn-submit-add-registro").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* EDITA REGISTRO */

    $(".form-edita-registro").submit(function (e) {
        e.preventDefault();

	    $.post("updateRegistro.php", { idregistro_phm: $("#idregistro_phm").val(), idregistro_shm: $("#idregistro_shm").val(), idregistro_pht: $("#idregistro_pht").val(), idregistro_sht: $("#idregistro_sht").val(), idlogin: $("#idlogin-").val(), tab: $("#tab").val(), dia: $("#dia").val(), mes: $("#mes").val(), ano: $("#ano").val(), phm: $("#phm").val(), shm: $("#shm").val(), pht: $("#pht").val(), sht: $("#sht").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-edita-registro").html('<img src="../img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            /*switch (data) {
            case 'reload':
                $.smkAlert({text: 'Nem todos os plugins foram carregados, recarregando...', type: 'danger', time: 2});
                location.reload();
                break;
            case 'true':
                $.smkAlert({text: 'Registro editado com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='index.php'", delay);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }*/
            if (data === "reload") {
                $.smkAlert({text: 'Nem todos os plugins foram carregados, recarregando...', type: 'danger', time: 2});
                location.reload();
            } else if (data.match(/<url>/g)) {
                $.smkAlert({text: 'Registro editado com sucesso.', type: 'success', time: 2});
                data = data.replace("<url>", "");
                data = data.replace("</url>", "");
                //document.location = data;
                window.setTimeout("location.href='" + data + "'", delay);
            } else {
                $.smkAlert({text: data, type: 'warning', time: 3});
            }

            $(".btn-submit-edita-registro").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });
});
